<extend name="Public/base" />
<block name="style">
	<link rel="stylesheet" href="" />
	<style>
		.alert-main{
			min-height: 485px;
		}
		ul {
			list-style: none;
			margin: 0;
		}
		
		.Adedit {
			border: 1px solid #ddd;
			/*margin-top: 15px;*/
			font-size: 16px;
			padding: 0 0 10px 10px !important;
		}
		
		.edit-container {
			font-size: 15px !important;
			margin-bottom: 15px;
		}
		
		label input[type=checkbox].ace,
		label input[type=radio].ace {
			z-index: -100!important;
			width: 1!important;
			height: 0!important;
		}
		
		input[type=checkbox].ace,
		input[type=radio].ace {
			opacity: 0;
			position: absolute;
			z-index: 1;
			width: 18px;
			height: 18px;
			cursor: pointer;
		}
		
		.edit-con01 {
			display: inline-block;
			text-align: right;
			width: 119px;
		}
		
		.inline {
			margin-right: 20px;
		}
		
		.inline-w {
			width: 7em;
		}
		
		[class*='col-'] {
			padding: 0px;
		}
		
		.durg-name {
			height: 600px;
			overflow-y: auto;
		}
		
		.choose-show {
			border: 1px solid #ddd;
			/*padding-left: 10px;*/
		}
		
		.lists a {
			margin: 10px 10px 0 0;
		}
		
		.form-actions {
			background: none;
			border-top: none;
		}
		
		.top {
			line-height: 34px;
			padding-top: 10px;
		}
		
		.top>span {
			color: #71502C;
			font-size: 18px;
			padding-left: 10px;
		}
		
		.top b {
			color: #999;
			font-size: 18px;
			cursor: pointer;
			margin-top: 8px;
			margin-right: 8px;
		}
		
		.all-select-div {
			font-size: 24px;
		}
		
		tr,
		th,
		td {
			text-align: center;
		}
		.M-box,
		.M-box1,
		.M-box2,
		.M-box3 {
			position: relative;
			text-align: center;
			zoom: 1;
			margin-bottom: 20px;
		}
		
		.M-box:before,
		.M-box:after,
		.M-box1:before,
		.M-box1:after,
		.M-box2:before,
		.M-box2:after,
		.M-box3:before,
		.M-box3:after {
			content: "";
			display: table;
		}
		
		.M-box:after,
		.M-box1:after,
		.M-box2:after,
		.M-box3:after {
			clear: both;
			overflow: hidden;
		}
		
		.M-box span,
		.M-box1 span,
		.M-box2 span,
		.M-box3 span {
			/*float: left;*/
			display: inline-block;
			margin: 0 5px;
			width: 38px;
			height: 38px;
			line-height: 38px;
			color: #bdbdbd;
			font-size: 14px;
		}
		
		.M-box .active,
		.M-box1 .active,
		.M-box2 .active,
		.M-box3 .active {
			/*float: left;*/
			margin: 0 5px;
			display: inline-block;
			width: 38px;
			height: 38px;
			line-height: 38px;
			background: #87b87f;
			color: #fff;
			font-size: 14px;
			border: 1px solid #87b87f;
		}
		
		.M-box a,
		.M-box1 a,
		.M-box2 a,
		.M-box3 a {
			/*float: left;*/
			display: inline-block;
			margin: 0 5px;
			width:38px;
			height: 38px;
			line-height: 38px;
			background: #fff;
			border: 1px solid #ebebeb;
			color: #bdbdbd;
			font-size: 14px;
		}
		
		.M-box a:hover,
		.M-box1 a:hover,
		.M-box2 a:hover,
		.M-box3 a:hover {
			color: #fff;
			background: #87b87f;
		}
		
		.M-box .next,
		.M-box .prev,
		.M-box1 .next,
		.M-box1 .prev {
			font-family: "Simsun";
			font-size: 16px;
			font-weight: bold;
		}
		
		.now,
		.count {
			padding: 0 5px;
			color: #f00;
		}
	</style>

</block>
<block name='navi'><li>行情资讯</li><li>栏目管理</li></block>
<block name="body">
	<div class="page-header">
		<h1>{:isset($info['id'])?'编辑':'新增'}发现</h1>
	</div>
	<div class="row">
		<div class="col-xs-12">
			<ul class="nav nav-tabs">
				<li class="active">
					<a data-toggle="tab" href="#tab1"><i class="green ace-icon fa fa-home bigger-120"></i>基 础</a>
				</li>
			</ul>
			<div class="tab-content">
				<form action="{:U('add')}" method="post" class="form-horizontal" id="myform">
					<!--<input type="hidden" name="id" value="{$info.id}">-->
					<input type="hidden" name="title_type" id="title_type" value="">
					<input type="hidden" name="title_id" id="title_id" value=''>				
					<div id="tab1" class="tab-pane fade active in">
					</div>
					<div class="col-xs-12 edit-container">
						<div class="row">
							<div class="col-xs-3 text-right">
								<i class="ace-icon fa fa-asterisk red smaller-50"></i>&nbsp;&nbsp;全部发现分类：
							</div>
							<div class="col-xs-5 Adedit lists">
								<a id="modal-445281" href="#modal-container-445281" role="button" class="btn btn-success drug-class" data-toggle="modal" data-params="1">仓储</a>
								<a id="modal-445281" href="#modal-container-445281" role="button" class="btn btn-success drug-class" data-toggle="modal" data-params="2">物流</a>
								<a id="modal-445281" href="#modal-container-445281" role="button" class="btn btn-success drug-class" data-toggle="modal" data-params="3">检测</a>
								<a id="modal-445281" href="#modal-container-445281" role="button" class="btn btn-success drug-class" data-toggle="modal" data-params="4">待加工</a>
								<a id="modal-445281" href="#modal-container-445281" role="button" class="btn btn-success drug-class" data-toggle="modal" data-params="5">药膳</a>
							</div>
						</div>
					</div>
					<div class="col-xs-12 edit-container">
						<div class="row">
							<div class="col-xs-3 text-right">
								<i class="ace-icon fa fa-asterisk red smaller-50"></i>&nbsp;&nbsp;已选中的内容：
							</div>
							<div class="col-xs-5 choose-show">
								<div class="top">
								</div>
								<table class="table table-striped table-hover">
									<tr>
									</tr>
								</table>
							</div>
						</div>
					</div>
					<div class="clearfix form-actions">
						<div class="col-md-offset-3 col-md-9">
							<button type="submit" id="submit" class="btn btn-info submit-btn ajax-post" target-form="form-horizontal"><i class="ace-icon fa fa-check bigger-110"></i>确 定</button>
							<button class="btn btn-return" onclick="javascript:history.back(-1);return false;"><i class="ace-icon fa fa-undo bigger-110"></i>返 回</button>
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>
	<!--弹窗弹窗-->
	<!--下面的a标签可以进行相应的调整位置-->
	<div class="modal fade alert-wp" id="modal-container-445281" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
					<h4 class="modal-title" id="myModalLabel"></h4>
				</div>
				<div class="modal-body alert-main">
				</div>
				<div class="M-box1"></div>
				<div class="modal-footer">
					<button type="button" class="btn btn-success sub-btn" data-dismiss="modal">确定</button>
				</div>
			</div>
		</div>
	</div>
</block>

<block name="script">
	<script src="__PUBLIC__/Admin/ace/js/jquery.pagination.min.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		//导航高亮
		highlight_subnav("{:U('Discover/index')}");
		$(function() {
			var titleType = $("#title_type"),
				titleId = $("#title_id");
			//删除
			$(".choose-show").on("click", ".del", function() {
				var dom = '<div class="top"></div><table class="table table-striped table-hover"><tr></tr></table>'
				$(this).parents(".choose-show").html(dom);
				titleType.val("");
				titleId.val("");
			});
			//关闭close
			$(".close").click(function () {
                $(".alert-main").html('');
            });
			//确定事件
			var myModalLabel = $("#myModalLabel");
			$(".sub-btn").click(function() {
				var id = '';
				//判断选择是否为空
				var isE = true;
				$(".choose-input").each(function() {
					if($(this).prop("checked")) {
						isE = false;
						id = $(this).parents("tr").find("td:first").text();
					}
				});
				if(isE) {
					alert("请选择");
					return false;
				}
				var table_code = myModalLabel.attr("data-params"),
					txt = myModalLabel.text();
				var span = '<span data-param="' + table_code + '">' + txt + '</span><b class="glyphicon glyphicon-trash del pull-right"></b>'
				$(".choose-show .top").html(span);
				$(".choose-input").each(function() {
					if($(this).prop("checked")) {
						var html = $(this).parents("table").find("thead").html();
						html += '<tr>';
						html += $(this).parents("tr").html();
						html += '</tr>';
						$(".choose-show table").html(html);
						$(".choose-td").remove();
					}
				});
				titleType.val(table_code);
				titleId.val(id);
                $(".alert-main").html('');
			});

			var dataArr = [],
				datasLength = 0;
			//点击弹出对应
			$(".drug-class").click(function() {
				//分页
				var table_code = $(this).attr("data-params"),
					txt = $(this).text();
				$.ajax({
					type: 'POST',
					url: " {:U('ajaxGetTypes')}",
					data: {
						table_code: table_code
					},
					success: function(data) {
						//定义一些变量
						var currentPage ,  num = 10;
						var l = 0;
						if(data) {
							dataArr = data;
							l = data.length;
						}else {
                            dataArr = [];
						}
						datasLength = dataArr.length;
						//初始页数 进去为第一页
						var page = 1;
						$("#myModalLabel").text(txt);
						$("#myModalLabel").attr("data-params", table_code);
						loadData();
						function loadData() {
							var html = '';
							var beforeNum = (page - 1) * num;
							num = num <  (datasLength - beforeNum) ? num : (datasLength - beforeNum);
							if(table_code == 1) {
								$(".alert-main").html('<table class="table table-striped table-hover"><thead><tr><th class="col-xs-2">ID</th><th class="col-xs-6">仓储类型</th><th class="col-xs-2">仓储面积</th><th class="col-xs-2 choose-td">选择</th></tr></thead><tbody></tbody></table>')
								for(var i = 0; i < num; i++) {
									var id = dataArr[beforeNum + i].id,
										type = dataArr[beforeNum + i].type,
										size = dataArr[beforeNum + i].size;
									html += '<tr><td>' + id + '</td><td>' + type + '</td><td>' + size + '</td><td class="choose-td"><label class="inline"><input name="store" type="radio"  class="ace choose-input"/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="lbl"></span></label></td></tr>';
								}
							} else if(table_code == 2) {
								$(".alert-main").html('<table class="table table-striped table-hover"><thead><tr><th class="col-xs-2">ID</th><th class="col-xs-4">出发地</th><th class="col-xs-4">目的地</th><th class="col-xs-2 choose-td">选择</th></tr></thead><tbody></tbody></table>')
								for(var i = 0; i < num; i++) {
									var id = dataArr[beforeNum + i].id,
										begin = dataArr[beforeNum + i].begin,
										end = dataArr[beforeNum + i].end;
									html += '<tr><td>' + id + '</td><td>' + begin + '</td><td>' + end + '</td><td class="choose-td"><label class="inline"><input  name="logistics" type="radio"  class="ace choose-input"/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="lbl"></span></label></td></tr>';
								}
							} else if(table_code == 3) {
								$(".alert-main").html('<table class="table table-striped table-hover"><thead><tr><th class="col-xs-2">ID</th><th class="col-xs-8">检测方法</th><th class="col-xs-2 choose-td">选择</th></tr></thead><tbody></tbody></table>')
								for(var i = 0; i < num; i++) {
									var id = dataArr[beforeNum + i].id,
										content = dataArr[beforeNum + i].content;
									html += '<tr><td>' + id + '</td><td>' + content + '</td><td class="choose-td"><label class="inline"><input type="radio" name="check"  class="ace choose-input"/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="lbl"></span></label></td></tr>';
								}
							} else if(table_code == 4) {
								$(".alert-main").html('<table class="table table-striped table-hover"><thead><tr><th class="col-xs-2">ID</th><th class="col-xs-8">加工范围</th><th class="col-xs-2 choose-td">选择</th></tr></thead><tbody></tbody></table>')
								for(var i = 0; i < num; i++) {
									var id = dataArr[beforeNum + i].id,
										content = dataArr[beforeNum + i].content;
									html += '<tr><td>' + id + '</td><td>' + content + '</td><td class="choose-td"><label class="inline"><input type="radio" name="machining" class="ace choose-input"/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="lbl"></span></label></td></tr>';
								}
							} else if(table_code == 5) {
								$(".alert-main").html('<table class="table table-striped table-hover"><thead><tr><th class="col-xs-2">ID</th><th class="col-xs-8">标题</th><th class="col-xs-2 choose-td">选择</th></tr></thead><tbody></tbody></table>')
								for(var i = 0; i < num; i++) {
									var id = dataArr[beforeNum + i].id,
										title = dataArr[beforeNum + i].title;
									html += '<tr><td>' + id + '</td><td>' + title + '</td><td class="choose-td"><label class="inline"><input type="radio" name="medicined" class="ace choose-input"/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="lbl"></span></label></td></tr>';
								}
							}
							$(".alert-main tbody").html(html);
							currentPage = $(".M-box1 .active").text();
						}
						$('.M-box1').pagination({
							totalData: datasLength,
							showData: 10,
							coping: true,
							homePage: '首页',
							endPage: '末页',
							prevContent: '上页',
							nextContent: '下页'
						});
						$(".M-box1").on("click", "a", function() {
							if ($(this).attr("class") == "next"){
								page++;
							}else if ($(this).attr("class") == "prev"){
								page--;
								num = 10;
							}else{
								page = $(this).attr("data-page")
								if (currentPage > page){
									num = 10;
								}
							}
							loadData();
						});
					},
					error: function() {
						alert('加载失败');
					}
				});

			})
		});
	</script>
</block>