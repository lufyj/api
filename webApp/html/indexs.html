<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>药都网--类目页</title>
		<link rel="stylesheet" href="../css/reset.css" />
		<link rel="stylesheet" href="../css/iconfont/iconfont.css" />
		<link rel="stylesheet" href="../css/indexs.css" />
		<link rel="stylesheet" href="../css/swiper.min.css" />
		<script src="../js/jquery-3.1.1.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/common.js" type="text/javascript" charset="utf-8"></script>
	</head>
	<body>
		<div class="title clearfix">
			<a href="./demand.html" class="l">采购</a>
			<a href="./search.html" class="search_a"><span><i class="iconfont icon-ss"></i>搜药品</span></a>
			<a href="./supply.html" class="r">供应</a>
		</div>
		<!--后期修改-->
		<div class="swiper-container">
		  	<div class="swiper-wrapper banner_wp">
		    	<div class="swiper-slide"><a href="#" target="_blank"><img src="../images/banner_02.jpg"/></a></div>
		    	<div class="swiper-slide"> <a href="#" target="_blank"><img src="../images/banner_03.jpg"/></a></div>
		    	<div class="swiper-slide"><a href="#" target="_blank"><img src="../images/banner_04.jpg"/></a></div>
		    	<div class="swiper-slide"><a href="#" target="_blank"><img src="../images/banner_05.jpg"/></a></div>
		  	</div>
		  	<div class="swiper-pagination"></div>
		</div>
		<div class="i-m clearfix">
			<aside  class="m-classify">
				<ul id="cate_list">
					<li class="active"><a href="###">热门推荐</a></li>
				</ul>
			</aside>
			<aside class="m-content">
				<ul class="list01 lists show" id="hot_wp">
					<!--<li>-->
						<!--<a href="#">-->
							<!--<div>-->
								<!--<img src="../images/ydw2.png"/>-->
							<!--</div>-->
							<!--<span>三七粉</span>-->
						<!--</a>-->
					<!--</li>-->
				</ul>
				<div class="list02 lists">
					<div class="child01"></div>
					<div class="child02"></div>
					<!--<div class="btn">-->
						<!--<button>展开<i class="iconfont icon-zk"></i></button>-->
					<!--</div>-->
					<div class="child03"></div>
					<!--<div class="btn">-->
						<!--<button>展开<i class="iconfont icon-zk"></i></button>-->
					<!--</div>-->
					<div class="child04"></div>
				</div>
				<div class="list02 lists">
					<div class="child01"></div>
					<div class="child02"></div>
					<!--<div class="btn">-->
						<!--<button>展开<i class="iconfont icon-zk"></i></button>-->
					<!--</div>-->
					<div class="child03"></div>
					<!--<div class="btn">-->
						<!--<button>展开<i class="iconfont icon-zk"></i></button>-->
					<!--</div>-->
					<div class="child04"></div>
				</div>
				<div class="list02 lists">
					<div class="child01"></div>
					<div class="child02"></div>
					<!--<div class="btn">-->
					<!--<button>展开<i class="iconfont icon-zk"></i></button>-->
					<!--</div>-->
					<div class="child03"></div>
					<!--<div class="btn">-->
					<!--<button>展开<i class="iconfont icon-zk"></i></button>-->
					<!--</div>-->
					<div class="child04"></div>
				</div>
				<div class="list02 lists">
					<div class="child01"></div>
					<div class="child02"></div>
					<!--<div class="btn">-->
					<!--<button>展开<i class="iconfont icon-zk"></i></button>-->
					<!--</div>-->
					<div class="child03"></div>
					<!--<div class="btn">-->
					<!--<button>展开<i class="iconfont icon-zk"></i></button>-->
					<!--</div>-->
					<div class="child04"></div>
				</div>
				<div class="list02 lists">
					<div class="child01"></div>
					<div class="child02"></div>
					<!--<div class="btn">-->
					<!--<button>展开<i class="iconfont icon-zk"></i></button>-->
					<!--</div>-->
					<div class="child03"></div>
					<!--<div class="btn">-->
					<!--<button>展开<i class="iconfont icon-zk"></i></button>-->
					<!--</div>-->
					<div class="child04"></div>
				</div>
				<div class="list02 lists">
					<div class="child01"></div>
					<div class="child02"></div>
					<!--<div class="btn">-->
					<!--<button>展开<i class="iconfont icon-zk"></i></button>-->
					<!--</div>-->
					<div class="child03"></div>
					<!--<div class="btn">-->
					<!--<button>展开<i class="iconfont icon-zk"></i></button>-->
					<!--</div>-->
					<div class="child04"></div>
				</div>
				<div class="list02 lists">
					<div class="child01"></div>
					<div class="child02"></div>
					<!--<div class="btn">-->
					<!--<button>展开<i class="iconfont icon-zk"></i></button>-->
					<!--</div>-->
					<div class="child03"></div>
					<!--<div class="btn">-->
					<!--<button>展开<i class="iconfont icon-zk"></i></button>-->
					<!--</div>-->
					<div class="child04"></div>
				</div>
				<div class="list02 lists">
					<div class="child01"></div>
					<div class="child02"></div>
					<!--<div class="btn">-->
					<!--<button>展开<i class="iconfont icon-zk"></i></button>-->
					<!--</div>-->
					<div class="child03"></div>
					<!--<div class="btn">-->
					<!--<button>展开<i class="iconfont icon-zk"></i></button>-->
					<!--</div>-->
					<div class="child04"></div>
				</div>
				<div class="list02 lists">
					<div class="child01"></div>
					<div class="child02"></div>
					<!--<div class="btn">-->
					<!--<button>展开<i class="iconfont icon-zk"></i></button>-->
					<!--</div>-->
					<div class="child03"></div>
					<!--<div class="btn">-->
					<!--<button>展开<i class="iconfont icon-zk"></i></button>-->
					<!--</div>-->
					<div class="child04"></div>
				</div>
				<div class="list02 lists">
					<div class="child01"></div>
					<div class="child02"></div>
					<!--<div class="btn">-->
					<!--<button>展开<i class="iconfont icon-zk"></i></button>-->
					<!--</div>-->
					<div class="child03"></div>
					<!--<div class="btn">-->
					<!--<button>展开<i class="iconfont icon-zk"></i></button>-->
					<!--</div>-->
					<div class="child04"></div>
				</div>
				<div class="list02 lists">
					<div class="child01"></div>
					<div class="child02"></div>
					<!--<div class="btn">-->
					<!--<button>展开<i class="iconfont icon-zk"></i></button>-->
					<!--</div>-->
					<div class="child03"></div>
					<!--<div class="btn">-->
					<!--<button>展开<i class="iconfont icon-zk"></i></button>-->
					<!--</div>-->
					<div class="child04"></div>
				</div>
				<div class="list02 lists">
					<div class="child01"></div>
					<div class="child02"></div>
					<!--<div class="btn">-->
					<!--<button>展开<i class="iconfont icon-zk"></i></button>-->
					<!--</div>-->
					<div class="child03"></div>
					<!--<div class="btn">-->
					<!--<button>展开<i class="iconfont icon-zk"></i></button>-->
					<!--</div>-->
					<div class="child04"></div>
				</div>
				<div class="list02 lists">
					<div class="child01"></div>
					<div class="child02"></div>
					<!--<div class="btn">-->
					<!--<button>展开<i class="iconfont icon-zk"></i></button>-->
					<!--</div>-->
					<div class="child03"></div>
					<!--<div class="btn">-->
					<!--<button>展开<i class="iconfont icon-zk"></i></button>-->
					<!--</div>-->
					<div class="child04"></div>
				</div>
			</aside>
		</div>
		<footer>
			<a href="javascript:;" class="tab_lm">
				<i class="iconfont icon_lm"></i>
				<p>类目</p>
			</a>
			<a href="./follow.html" class="tab_follow">
				<i class="iconfont icon_gz"></i>
				<p>关注</p>
			</a>
			<a href="./index.html" class="home tab_home"></a>
			<a href="./discover.html" class="tab_follow">
				<i class="iconfont icon_fx"></i>
				<p>发现</p>
			</a>
			<a href="./persional.html" class="tab_perisonal">
				<i class="iconfont icon_geren"></i>
				<p>个人</p>
			</a>
		</footer>
	    <script src="../js/swiper.min.js" type="text/javascript" charset="utf-8"></script>
	    <script type="text/javascript">
	    	var mySwiper = new Swiper('.swiper-container', {
					autoplay: 1000,//可选选项，自动滑动
					pagination : '.swiper-pagination',
					autoplayDisableOnInteraction : false
				});
	    	$(function(){
	    		var contents = $('.m-content .lists');//药材详情
				var listWp = $("#cate_list");
				var hotWp = $("#hot_wp");
                listWp.on("click" ,'li' ,function(){
                    var _this = $(this);
                    var i = _this.index();
                    listWp.find("li").removeClass('active');
                    _this.addClass('active');
                    contents.removeClass('show');
                    var dataWp = contents.eq(i);
                    dataWp.addClass('show');
                    var id = _this.attr("data-id");
                    if (dataWp[0].isLoad) return;
                    if (!id) {
                        getHot();
                        return;
                    }
                    getGoods(dataWp , id);
                });
				function getHot() {
                    $.post(rule.root + 'AppHot/goods_hot' , {clientType:1} , function (data) {
                        var code = data.code;
                        if (code == 1){
                            var datas = data.data;
                            var datasL = datas.length;
                            var str = '';
                            for (var i = 0; i < datasL; i++){
								var img = datas[i].goods_img;
								var id = datas[i].id;
								var goodsName = datas[i].goods_name;
								str += '<li><a href="javascript:;" class="link_a" data-id="'+ id +'"><div><img src="'+ img +'"/></div><span>'+ goodsName +'</span></a></li>'
							}
                            hotWp.html(str)
						}
                    })
                }
	    		var btn = $('.btn');//展开按钮
	    		btn.on('click',function(){
	    			var _this = $(this);
	    			_this.prev().css('max-height','none');
	    			_this.remove();
	    		});
				$.post(rule.root + 'Class/goods_category' , {clientType:1} , function(data){
					var li = '';
					var code = data.code;
					if (code == 1){
						var datas = data.data;
						var datasL = datas.length;
						for (var i = 0; i < datasL; i++){
							var id = datas[i].id;
							var title = datas[i].title;
							li += '<li data-id="'+ id +'"><a href="javascript:;">'+ title +'</a></li>';
						}
						$("#cate_list").append(li);
					}else if (code == 0){
						console.log("查询失败");
					}
				})
				function getGoods(obj , id){
				    var params = {
                        clientType:1,
                        cate_id:id
					}
                    $.post(rule.root + "Class/goods_name" ,params , function (req){
                        var code = req.code;
                        var arr2 = [];
                        var arr3 = [];
                        var arr4 = [];
                        var arr5 = [];
                        if (code == 1){
                            var datas = req.data;
                            var datasL  = datas.length;
                            for (var i = 0; i < datasL; i++){
                                var goods_name = datas[i].goods_name;
                                var l = goods_name.length;
                                if (l <= 2){
                                    arr2.push(datas[i])
                                }else if (l == 3){
                                    arr3.push(datas[i])
                                }else if (l == 4){
                                    arr4.push(datas[i])
                                } else if (l >= 4){
                                    arr5.push(datas[i])
                                }
                            }
                            var arr = [];
                            arr.push(arr2 , arr3 , arr4 , arr5);
                            var arrLength = arr.length;
                            var a2 = '' , a3 = '', a4 = '' ,a5 = '';
                            for (var i = 0; i < arrLength; i++){
                                for (var j = 0; j < arr[i].length; j++){
                                    var gn = arr[i][j].goods_name;
                                    var cateId = arr[i][j].cate_id;
                                    var id = arr[i][j].id;
                                    var goodsName = encodeURI(encodeURI(gn));
                                    if (i == 0){
                                        a2 += '<a href="javascript:;" class="link_a" data-id="'+ id +'">'+ gn +'</a>';
                                    }else if (i == 1){
                                        a3 += '<a href="javascript:;" class="link_a" data-id="'+ id +'">'+ gn +'</a>'
                                    }else if (i == 2){
                                        a4 += '<a href="javascript:;" class="link_a" data-id="'+ id +'">'+ gn +'</a>'
                                    } else if (i == 3){
                                        a5 += '<a href="javascript:;" class="link_a" data-id="'+ id +'">'+ gn +'</a>'
                                    }
                                }
                            }
                            obj.find(".child01").html(a2);
                            obj.find(".child02").html(a3);
                            obj.find(".child03").html(a4);
                            obj.find(".child04").html(a5);
                            obj[0].isLoad = true;
                        }else if (code == 0){
							alert("网络错误");
                        }
                    })
				}
				//首页轮播图
				function getBanner(){
					$.post(rule.root + "AppBanner/index" , {clientType:1} , function (data) {
						console.log(data);
						var code = data.code;
						if (code == 1){
						    var datas = data.data;
						    var datasL = datas.length;
						    var str = '';
						    for (var i = 0; i < datasL; i++){
								var imgUrl = datas[i].img_url;
                                var linkUrl = datas[i].link_url;
                                var id = datas[i].id;
                                str += '<div class="swiper-slide"><a href="'+ linkUrl +'" target="_blank"><img src="'+ imgUrl +'"/></a></div>';
							}
							$(".banner_wp").html(str);
						}
                    })
				}
				//初始化热门药材
                getHot();
				//轮播图初始化
                getBanner();
                var local = new LocalData();
				$(".m-content").on("click" ,".link_a" , function () {
				    var _this = $(this);
				    var gn = _this.text();
				    var id = _this.attr("data-id");
				    var data = {
                        goods_name:gn,
						id:id
					}
                    local.setData("goodsmsg" , data);
				    location.href = './goodsmsg.html';
                })
	    	});
	    </script>
	</body>
</html>
